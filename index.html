<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Estratificador de Pacientes ECICEP</title>
  <meta name="description" content="ECICEP (52 condiciones) — CIE-10 tabular aplicado sin huecos"/>
  <style>
    :root{ --primary:#0b5ed7; --secondary:#f6f7fb; --border:#e5e7eb; --text:#1f2937; --bg:#fff;
      --g0:#28a745; --g1:#17a2b8; --g2:#ffc107; --g3:#dc3545; --shadow:0 6px 16px rgba(0,0,0,.08);
      --hl:#fff3cd; --hl-border:#ffe69c; }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:var(--secondary);color:var(--text);margin:0;padding:24px}
    .container{max-width:1200px;margin:0 auto;background:var(--bg);border-radius:14px;box-shadow:var(--shadow);
      padding:24px;border:1px solid var(--border)}
    header h1{margin:0 0 6px;color:var(--primary);text-align:center}
    header p{margin:0 0 14px;text-align:center;color:#374151}
    .main{display:grid;grid-template-columns:1fr 340px;gap:24px}
    @media (max-width:980px){.main{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:14px}

    details{border:1px solid var(--border);border-radius:10px;background:#fafafa;margin-top:12px}
    summary{cursor:pointer;list-style:none;padding:12px 14px;font-weight:700;color:#fff;background:var(--primary);
      border-radius:10px;display:flex;align-items:center;justify-content:space-between}
    details[open] summary{border-bottom-left-radius:0;border-bottom-right-radius:0}
    .level-wrap{padding:10px 12px;background:#fff;border-top:1px solid var(--border);border-bottom-left-radius:10px;border-bottom-right-radius:10px}

    .sub-details{border:1px solid #dbeafe;border-radius:8px;background:#eef2ff;margin:10px 0}
    .sub-summary{background:#eef2ff;color:#1e40af;border-radius:8px;padding:8px 12px;font-weight:700;
      display:flex;align-items:center;justify-content:space-between}
    .sub-content{padding:8px 10px;background:#fff;border-top:1px solid #dbeafe}

    .row{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:8px;padding:8px 0;border-bottom:1px dashed #eceff3}
    .row:last-child{border-bottom:none}
    .row input[type=checkbox]{width:18px;height:18px}
    .row label{font-weight:600}
    .row.match{background:var(--hl);border:1px solid var(--hl-border);border-radius:8px;padding:8px;margin:4px 0}
    .badge{font-size:.75rem;font-weight:700;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#fff}

    .topbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;margin:6px 0 14px}
    .search{flex:1;display:flex;gap:8px}
    .search input{flex:1;padding:12px 14px;border:1px solid var(--border);border-radius:10px;font-size:1rem}
    .search button{padding:12px 14px;border:1px solid var(--border);border-radius:10px;background:#f3f4f6;cursor:pointer}

    .cie{margin:8px 0 16px 26px;border:1px dashed #e5e7eb;border-radius:8px;background:#f9fafb}
    .cie summary{background:#f3f4f6;color:#111827;border-radius:8px;padding:6px 10px}
    .cie .inner{padding:10px}
    .cie-table{width:100%;border-collapse:collapse;font-size:.92rem}
    .cie-table th,.cie-table td{border:1px solid #e5e7eb;padding:6px 8px;text-align:left}
    .cie-table th{background:#eef2ff;color:#1e3a8a}
    .cie-help{font-size:.82rem;color:#6b7280;margin-top:4px}

    .results h3{margin:0 0 10px;color:#0b5ed7;text-align:center;border-bottom:2px solid var(--border);padding-bottom:10px}
    #score{font-size:3.2em;text-align:center;font-weight:900;margin:10px 0;color:#111827}
    #glevel{text-align:center;font-weight:900;font-size:2em;margin-bottom:10px;color:#fff;border-radius:8px;padding:6px}
    #gdesc{font-size:.95em;padding:10px;background:#f8fafc;border-radius:8px;border-left:6px solid}
    .g0{background-color:var(--g0);border-color:var(--g0)} .g1{background-color:var(--g1);border-color:var(--g1)}
    .g2{background-color:var(--g2);border-color:var(--g2);color:#111827} .g3{background-color:var(--g3);border-color:var(--g3)}
    .btn{width:100%;padding:12px;font-size:1.05em;font-weight:800;border:none;border-radius:10px;cursor:pointer;background:#374151;color:#fff;margin-top:10px}
    footer{margin-top:18px;font-size:.9rem;color:#4b5563;text-align:center}
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>Estratificador de Pacientes ECICEP</h1>
    <p>Basado en el Anexo oficial (52 condiciones). CIE-10 tabular aplicado.</p>

    <details class="card" open>
      <summary class="sub-summary">Cómo usarlo</summary>
      <div class="sub-content">
        <ol>
          <li>Abra los bloques de <strong>2 puntos</strong> y <strong>1 punto</strong> y marque las condiciones que correspondan.</li>
          <li>El buscador es <strong>complementario</strong>: despliega solapas y <em>resalta</em> coincidencias por nombre o código CIE-10.</li>
          <li>En cada ítem puede ver el detalle de <strong>CIE-10</strong> (código + diagnóstico) desplegando la sección.</li>
          <li>La tarjeta derecha muestra el <strong>puntaje total</strong> y el <strong>nivel G0–G3</strong> automáticamente.</li>
          <li>Use <strong>“Limpiar selección”</strong> para reiniciar todo.</li>
        </ol>
      </div>
    </details>
  </header>

  <div class="main">
    <div>
      <div class="card">
        <div class="topbar">
          <div class="search" style="width:100%">
            <input id="q" type="search" placeholder="Buscar patología o código CIE-10…" aria-label="Buscar patología" />
            <button id="clearQ" title="Limpiar búsqueda">Limpiar</button>
          </div>
        </div>
        <h2 style="margin:6px 0 12px">Condiciones crónicas</h2>
        <div id="list"></div>
      </div>
    </div>

    <aside>
      <div class="card results">
        <h3>Resultado de Estratificación</h3>
        <div id="score">0</div>
        <div id="glevel" class="g0">G0</div>
        <p id="gdesc" class="g0"><strong>Bajo Riesgo:</strong> Sin patologías con puntaje.</p>
        <button class="btn" onclick="resetForm()">Limpiar selección</button>
      </div>
      <footer>
        Creado por <strong>Diego Ortega Araya</strong>.
      </footer>
    </aside>
  </div>
</div>

<script>
/* ==========================
   Helpers
   ========================== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function el(tag, props={}, children=[]){
  const n=document.createElement(tag);
  Object.entries(props).forEach(([k,v])=>{
    if(k==='class') n.className=v;
    else if(k==='text') n.textContent=v;
    else if(k==='html') n.innerHTML=v;
    else n[k]=v;
  });
  children.forEach(c=>n.appendChild(c));
  return n;
}
function normalize(s){
  return (s||'').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
}

/* ==========================
   Diccionario CIE-10 (solo códigos usados literalmente abajo)
   — Si un ítem usa un rango (p. ej., C00–C97), se pasa como objeto con label.
   ========================== */
const CIE = {
  // Demencia / Dependencia
  "F00":"Demencia en enfermedad de Alzheimer",
  "F01":"Demencia vascular",
  "F02":"Demencia en otras enfermedades",
  "F03":"Demencia, no especificada",
  "R26":"Anomalías de la marcha y de la movilidad",
  "Z74":"Necesidad de ayuda para el cuidado personal",
  "Z99":"Dependencia de aparatos y equipos",

  // Depresión grave (2 pts)
  "F33.2":"Trastorno depresivo recurrente, episodio actual grave, sin síntomas psicóticos",
  "F33.3":"Trastorno depresivo recurrente, episodio actual grave, con síntomas psicóticos",

  // Esquizofrenia (1 pto)
  "F20":"Esquizofrenia",
  "F21":"Trastorno esquizotípico",
  "F22":"Trastornos delirantes persistentes",
  "F23":"Trastornos psicóticos agudos y transitorios",

  // ECV / IAM / isquémica (2 ptos)
  "G46":"Síndromes vasculares cerebrales",
  "I64":"Accidente cerebrovascular agudo, no especificado",
  "I67":"Otros trastornos cerebrovasculares",
  "I68":"Trastornos cerebrovasculares en otras enfermedades",
  "I20":"Angina de pecho",
  "I21":"Infarto agudo de miocardio",
  "I22":"Infarto subsecuente de miocardio",
  "I25":"Cardiopatía isquémica crónica",
  "I51":"Otras enfermedades del corazón",
  "I52":"Trastornos cardiacos en otras enfermedades",

  // TIA (1 pto)
  "G45":"Ataques isquémicos transitorios",

  // Diabetes complicadas (2 ptos: .2 .3 .4 .5 .7)
  "E10.2":"DM tipo 1 con complicaciones renales",
  "E10.3":"DM tipo 1 con complicaciones oftálmicas",
  "E10.4":"DM tipo 1 con complicaciones neurológicas",
  "E10.5":"DM tipo 1 con complicaciones circulatorias periféricas",
  "E10.7":"DM tipo 1 con complicaciones múltiples",
  "E11.2":"DM tipo 2 con complicaciones renales",
  "E11.3":"DM tipo 2 con complicaciones oftálmicas",
  "E11.4":"DM tipo 2 con complicaciones neurológicas",
  "E11.5":"DM tipo 2 con complicaciones circulatorias periféricas",
  "E11.7":"DM tipo 2 con complicaciones múltiples",
  "E12.2":"DM por desnutrición con complicaciones renales",
  "E12.3":"DM por desnutrición con complicaciones oftálmicas",
  "E12.4":"DM por desnutrición con complicaciones neurológicas",
  "E12.5":"DM por desnutrición con complicaciones circulatorias periféricas",
  "E12.7":"DM por desnutrición con complicaciones múltiples",
  "E13.2":"Otras DM especificadas con complicaciones renales",
  "E13.3":"Otras DM especificadas con complicaciones oftálmicas",
  "E13.4":"Otras DM especificadas con complicaciones neurológicas",
  "E13.5":"Otras DM especificadas con complicaciones circulatorias periféricas",
  "E13.7":"Otras DM especificadas con complicaciones múltiples",
  "E14.2":"DM no especificada con complicaciones renales",
  "E14.3":"DM no especificada con complicaciones oftálmicas",
  "E14.4":"DM no especificada con complicaciones neurológicas",
  "E14.5":"DM no especificada con complicaciones circulatorias periféricas",
  "E14.7":"DM no especificada con complicaciones múltiples",

  // ERC
  "N18.1":"Enfermedad renal crónica, estadio 1",
  "N18.2":"Enfermedad renal crónica, estadio 2",
  "N18.3":"Enfermedad renal crónica, estadio 3",
  "N18.4":"Enfermedad renal crónica, estadio 4",
  "N18.5":"Enfermedad renal crónica, estadio 5",
  "N18.6":"Enfermedad renal terminal",
  "N19":"Insuficiencia renal, no especificada",

  // Salud mental y conductual (1 pto)
  "F33.0":"Trastorno depresivo recurrente, episodio actual leve",
  "F33.1":"Trastorno depresivo recurrente, episodio actual moderado",
  "F40":"Trastornos de ansiedad fóbica",
  "F41":"Otros trastornos de ansiedad",
  "F42.2":"Trastorno obsesivo-compulsivo, forma mixta",
  "F42.8":"Otros trastornos obsesivos-compulsivos",
  "F42.9":"Trastorno obsesivo-compulsivo, no especificado",
  "F60":"Trastornos específicos de la personalidad",
  "F61":"Trastornos mixtos de la personalidad",
  "F62.0":"Cambio perdurable de la personalidad tras experiencia catastrófica",
  "F62.1":"Cambio perdurable tras enfermedad psiquiátrica",
  "F62.8":"Otros cambios perdurables de la personalidad",
  "F62.9":"Cambio perdurable de la personalidad, NE",
  "F68.0":"Elaboración de síntomas físicos por causas psicológicas",
  "F69":"Trastorno de la personalidad y del comportamiento, NE",
  "F51.0":"Insomnio no orgánico",
  "F51.1":"Hipersonmia no orgánica",
  "F51.2":"Trastorno del ciclo vigilia-sueño",
  "F51.4":"Trastornos del ritmo del sueño",
  "F51.8":"Otros trastornos no orgánicos del sueño",
  "F51.9":"Trastorno no orgánico del sueño, NE",
  "G47.3":"Apnea del sueño",
  "G47.4":"Narcolepsia y cataplejía",
  "G47.8":"Otros trastornos del sueño",
  "G47.9":"Trastorno del sueño, NE",
  "F31":"Trastorno afectivo bipolar",
  "F34.0":"Ciclotimia",
  "F34.1":"Distimia",
  "F34.8":"Otros trastornos del humor persistentes",
  "F34.9":"Trastorno del humor persistente, NE",
  "F63.0":"Juego patológico",
  "F63.2":"Tricotilomanía",
  "F63.8":"Otros trastornos de los hábitos e impulsos",
  "F63.9":"Trastorno de los hábitos e impulsos, NE",
  "F66.1":"Trastorno de la identidad sexual",
  "F66.2":"Trastorno del desarrollo psicosexual",
  "F66.8":"Otros trastornos del desarrollo sexual",
  "F66.9":"Trastorno del desarrollo sexual, NE",
  "F50":"Trastornos de la ingestión de alimentos",
  "F10":"Trastornos mentales y del comportamiento debidos al alcohol",
  "Y91.2":"Efectos del alcohol, nivel moderado",
  "Y91.3":"Efectos del alcohol, nivel grave",
  "Y91.9":"Efectos del alcohol, nivel no especificado",
  "Z71.4":"Consejería relacionada con el alcohol",
  "Z72.1":"Uso perjudicial de alcohol",
  "F17":"Trastornos mentales y del comportamiento por uso de tabaco",
  "T65.2":"Efecto tóxico de nicotina",
  "Z71.6":"Consejería por consumo de tabaco",
  "Z72.0":"Uso de tabaco",
  "F11":"Trastornos por consumo de opiáceos",
  "F12":"Trastornos por consumo de cannabinoides",
  "F13":"Trastornos por consumo de sedantes o hipnóticos",
  "F14":"Trastornos por consumo de cocaína",
  "F15":"Trastornos por consumo de otros estimulantes",
  "F16":"Trastornos por consumo de alucinógenos",
  "F18":"Trastornos por consumo de disolventes volátiles",
  "F19":"Trastornos por consumo de múltiples drogas",
  "Z72.2":"Uso de drogas",

  // Cardiometabólico y renal (1 pto)
  "E78":"Trastornos del metabolismo de las lipoproteínas (dislipidemias)",
  "I10":"Hipertensión esencial (primaria)",
  "I11":"Enfermedad cardíaca hipertensiva",
  "I12":"Enfermedad renal hipertensiva",
  "I13":"Enfermedad cardiaca y renal hipertensiva",
  "I15":"Hipertensión secundaria",
  "I48":"Fibrilación y aleteo auricular",
  "I47":"Taquicardia paroxística",
  "I49":"Otras arritmias cardíacas",
  "I50":"Insuficiencia cardíaca",
  "E66":"Obesidad",
  "N40":"Hiperplasia prostática benigna",
  "M10":"Gota (hiperuricemia)",

  // Respiratorio
  "J45":"Asma",
  "J46":"Estado asmático",
  "J41":"Bronquitis crónica simple y mucopurulenta",
  "J42":"Bronquitis crónica, NE",
  "J43":"Enfisema",
  "J44":"Otras enfermedades pulmonares obstructivas crónicas",

  // Neurológico
  "G40":"Epilepsia",
  "G35":"Esclerosis múltiple",
  "G20":"Enfermedad de Parkinson",
  "G21":"Parkinsonismo secundario",
  "G22":"Parkinsonismo en otras enfermedades",
  "G50":"Trastornos del trigémino",
  "M79.7":"Fibromialgia",

  // Reumatología / MSQ
  "M05":"Artritis reumatoide seropositiva",
  "M06":"Otras artritis reumatoides",
  "M15":"Poliartrosis",
  "M16":"Coxartrosis (artrosis de cadera)",
  "M17":"Gonartrosis (artrosis de rodilla)",
  "M18":"Artrosis de la primera articulación carpometacarpiana",
  "M19":"Otras artrosis",

  // Hígado / VIH / EII / TB
  "B18":"Hepatitis viral crónica",
  "K70":"Enfermedad hepática alcohólica",
  "K71":"Enfermedad hepática tóxica",
  "K72":"Insuficiencia hepática",
  "K73":"Hepatitis crónica",
  "K74":"Fibrosis y cirrosis del hígado",
  "K75":"Otras enfermedades inflamatorias del hígado",
  "K76":"Otras enfermedades del hígado",
  "K76.6":"Hipertensión portal",
  "K77":"Trastornos del hígado en otras enfermedades",
  "K50":"Enfermedad de Crohn",
  "K51":"Colitis ulcerosa",
  "K52":"Otras colitis no infecciosas",
  "B20":"Enfermedad por VIH con infecciones",
  "B21":"Enfermedad por VIH con neoplasias malignas",
  "B22":"Enfermedad por VIH con otras enfermedades",
  "B23":"Otras afecciones por VIH",
  "B24":"Enfermedad por VIH, no especificada",
  "A15":"Tuberculosis respiratoria confirmada",
  "A16":"Tuberculosis respiratoria sin confirmación",
  "A17":"Tuberculosis del SNC",
  "A18":"TB de otros órganos",
  "A19":"TB miliar",

  // Órganos de los sentidos
  "H25":"Catarata senil",
  "H26":"Otras cataratas",
  "H28":"Trastornos del cristalino en otras enfermedades",
  "Q12":"Catarata congénita",
  "H54":"Ceguera y baja visión",
  "H40":"Glaucoma",
  "H42":"Glaucoma en otras enfermedades",
  "H90":"Hipoacusia conductiva y neurosensorial",
  "H91":"Otras hipoacusias",

  // Flebo/Dermato – Úlceras
  "I83.0":"Várices de miembros inferiores con úlcera",
  "I83.1":"Várices de miembros inferiores con inflamación",
  "I83.2":"Várices de miembros inferiores con úlcera e inflamación",
  "I83.9":"Várices de miembros inferiores, no especificadas",
  "L97":"Úlcera de extremidad inferior, no clasificada en otra parte",
  "L98.4":"Úlcera crónica de la piel, no clasificada en otra parte"
};

/* ==========================
   Grupos (exactamente 52 condiciones)
   ========================== */
const GROUPS = [
  { // 2 PUNTOS
    points:2,
    title:'Condiciones que suman 2 puntos',
    subgroups:[
      {
        name:'Neurológico / Salud mental crítica',
        items:[
          {id:'demencia', name:'Demencia', codes:['F00','F01','F02','F03']},
          {id:'dep_grave', name:'Depresión grave (recurrente; con/sin psicosis)', codes:['F33.2','F33.3']}
        ]
      },
      {
        name:'Eventos cardiovasculares / crónicos avanzados',
        items:[
          {id:'ecv', name:'Enfermedad cerebrovascular (ACV/AVE) y secuelas', codes:['G46','I64','I67','I68']},
          {id:'isci', name:'Cardiopatía isquémica (IAM/angina/CI crónica)', codes:['I20','I21','I22','I25','I51','I52']},
          {id:'dm_comp', name:'Diabetes mellitus con complicaciones severas', codes:[
            'E10.2','E10.3','E10.4','E10.5','E10.7',
            'E11.2','E11.3','E11.4','E11.5','E11.7',
            'E12.2','E12.3','E12.4','E12.5','E12.7',
            'E13.2','E13.3','E13.4','E13.5','E13.7',
            'E14.2','E14.3','E14.4','E14.5','E14.7'
          ]},
          {id:'erc_av', name:'Enfermedad renal crónica avanzada (IV–V o terminal)', codes:['N18.4','N18.5','N18.6']}
        ]
      },
      {
        name:'Funcionalidad',
        items:[
          {id:'dependencia', name:'Función limitada / discapacidad / dependencia', codes:['R26','Z74','Z99']}
        ]
      }
    ]
  },

  { // 1 PUNTO
    points:1,
    title:'Condiciones que suman 1 punto',
    subgroups:[
      {
        name:'Salud mental y conductual',
        items:[
          {id:'alcohol',     name:'Consumo perjudicial/dependiente de alcohol', codes:['F10','Y91.2','Y91.3','Y91.9','Z71.4','Z72.1']},
          {id:'tabaquismo',  name:'Tabaquismo',                                 codes:['F17','T65.2','Z71.6','Z72.0']},
          {id:'drogas',      name:'Consumo perjudicial o dependiente de drogas',codes:['F11','F12','F13','F14','F15','F16','F18','F19','Z72.2']},
          {id:'tca',         name:'Trastornos alimentarios',                    codes:['F50']},
          {id:'dep_leve',    name:'Depresión leve o moderada (recurrente)',     codes:['F33.0','F33.1']},
          {id:'ansiedad',    name:'Trastorno ansioso / TOC',                    codes:['F40','F41','F42.2','F42.8','F42.9']},
          {id:'personalidad',name:'Trastorno de la personalidad',               codes:['F60','F61','F62.0','F62.1','F62.8','F62.9','F68.0','F69']},
          {id:'sueno',       name:'Trastornos del sueño',                        codes:['F51.0','F51.1','F51.2','F51.4','F51.8','F51.9','G47.3','G47.4','G47.8','G47.9']},
          {id:'otros_sm',    name:'Otros trastornos de salud mental',           codes:['F31','F34.0','F34.1','F34.8','F34.9','F63.0','F63.2','F63.8','F63.9','F66.1','F66.2','F66.8','F66.9']},
          {id:'psicosocial', name:'Dificultades socioeconómicas/psicosociales', codes:[{code:'Z55–

</html>
